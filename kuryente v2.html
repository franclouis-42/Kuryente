<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Energy Calculator</title>
        <style>
            /* Add some basic styling to make the form look decent */
            body {
                font-family: Arial, sans-serif;
            }

            #navbar {
                overflow: hidden;
                background-color: #333;
            }

            #navbar h1 {
                float: left;
                display: block;
                color: #f2f2f2;
                text-align: center;
                padding: 14px 16px;
                text-decoration: none;
                font-size: 17px;
            }

            .content {
                padding: 10px;
            }

            .sticky {
                position: fixed;
                top: 0;
                width: 100%;
            }

            .sticky + .content {
                padding-top: 60px;
            }

            .sidebar {
                height: 100%;
                width: 0;
                position: fixed;
                z-index: 1;
                top: 0;
                right: 0;
                background-color: #e7e2e2a9;
                overflow-x: hidden;
                transition: 0.5s;
                padding-top: 60px;
                padding-left: 10px;
            }

            .sidebar .closebtn {
                position: absolute;
                top: 0;
                left: -45px;
                font-size: 36px;
                margin-left: 50px;
                color: black;
            }

            .openbtn {
                position: fixed;
                right: 2%;
                top: 3%;
                width: 3;
                height: 5%;
            }

            form {
                max-width: 400px;
                margin: 40px auto;
                padding: 20px;
                border: 1px solid #ccc;
                border-radius: 10px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            }
            label {
                display: block;
                margin-bottom: 10px;
            }
            input, select {
                width: 100%;
                padding: 10px;
                margin-bottom: 20px;
                border: 1px solid #ccc;
            }
            button[type="submit"] {
                background-color: #4CAF50;
                color: #fff;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            }
            button[type="submit"]:hover {
                background-color: #3e8e41;
            }
            table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            }
            th, td {
                padding: 10px;
                border: 1px solid #ccc;
            }
            th {
                background-color: #f2f2f2;
                font-weight: bold;
            }

            /* #result {
                height: auto;
                width: auto;
                display: contents;
            } */

            #main {
                transition: margin-right .5s;
                /* padding: 2px; */
            }
        </style>
    </head>
    <body>
        <div id="navbar">
            <h1>Power Smart Advisor</h1>
            <button class="openbtn" onclick="openNav()">☰ </button>
        </div>

        <div id="sidebar" class="sidebar">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla tincidunt velit quis mauris rutrum, in hendrerit nulla molestie. Donec nec condimentum magna, ut bibendum neque. Proin consequat sapien nec diam euismod, non molestie quam consectetur. Donec eu sapien a sapien aliquet porta ac nec ipsum. Duis velit lacus, rutrum sit amet sollicitudin id, lacinia eu ipsum. Nullam molestie, enim sed tristique luctus, felis urna ullamcorper tellus, nec imperdiet erat augue et nulla. Sed ullamcorper lacinia vestibulum. Nulla et lorem fermentum neque consectetur eleifend at a erat. Proin condimentum urna ut hendrerit fringilla. Integer id nulla vitae nulla ullamcorper aliquet. Donec pulvinar libero vitae semper imperdiet. Quisque id felis vel orci volutpat feugiat id sit amet tellus. Curabitur lobortis lectus arcu.
            </p>
        </div>
        <div class="content" id="main">
            <form id="energy-form">
                <h2>Energy Calculator</h2>
                <label for="target-budget">Target Budget (Php):</label>
                <input type="number" id="target-budget" name="target-budget" required>

                <label for="appliance">Select Appliance:</label>
                <select id="appliance" name="appliance" required>
                    <option value="">Select an appliance</option>
                    <optgroup label="Lighting/Ventilation">
                        <option value="Air Conditioning" data-wattage="3000" data-prio="0.25">Air Conditioning</option>
                        <option value="Electric Fan" data-wattage="3.6" data-prio="0.8">Electric Fan</option>
                        <option value="Light Bulb" data-wattage="4.5" data-prio="0.9">Light Bulb</option>
                    </optgroup>
                    <optgroup label="Cleaning">
                        <option value="Dishwasher" data-wattage="1200" data-prio="0.3">Dishwasher</option>
                        <option value="Iron:1100" data-wattage="1100" data-prio="0.60">Iron</option>
                        <option value="Washer" data-wattage="500" data-prio="0.55">Washer</option>
                        <option value="Dryer" data-wattage="1500" data-prio="0.5">Dryer</option>
                        <option value="Vacuum Cleaner" data-wattage="1000" data-prio="0.45">Vacuum Cleaner</option>
                    </optgroup>
                    <optgroup label="Cooking">
                        <option value="Induction Stove" data-wattage="1500" data-prio="0.75">Induction Stove</option>
                        <option value="Electric Stove" data-wattage="1000" data-prio="0.7">Electric Stove</option>
                        <option value="Kettle" data-wattage="1500" data-prio="0.69">Kettle</option>
                        <option value="Coffee Maker" data-wattage="1500" data-prio="0.4">Coffee Maker</option>
                        <option value="Heater" data-wattage="1500" data-prio="0.2">Heater</option>
                        <option value="Refrigerator" data-wattage="300" data-prio="1">Refrigerator</option>
                        <option value="Blender" data-wattage="500" data-prio="0.68">Blender</option>
                        <option value="Oven" data-wattage="900" data-prio="0.67">Oven</option>
                        <option value="Toaster" data-wattage="1100" data-prio="0.66">Toaster</option>
                        <option value="Microwave" data-wattage="600" data-prio="0.65">Microwave</option>
                    </optgroup>
                    <optgroup label="Entertainment">
                        <option value="Television" data-wattage="50" data-prio="0.15">Television</option>
                        <option value="Computer" data-wattage="30" data-prio="0.1">Computer</option>
                        <option value="Gadgets Chargers" data-wattage="51" data-prio="0.06">Gadgets Chargers</option>
                    </optgroup>
                    <optgroup label="Others">
                        <option>Other</option>
                    </optgroup>
                </select>

                <label for="wattage">Wattage (watts):</label>
                <input type="float" id="wattage" name="wattage" required>

                <label for="hours-used">Hours Used:</label>
                <input type="float" id="hours-used" name="hours-used" required>

                <button type="submit">Add Appliance</button>
            </form>

            <table id="appliance-table">
                <thead>
                    <tr>
                        <th>Appliance</th>
                        <th>Wattage</th>
                        <th>Hours Used</th>
                        <th>Cost (Php)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button id="calculate-button">Calculate</button>
            <div id="suggestion"></div>
            <div id="result">
                <table id="suggest-table" style="visibility: hidden;">
                    <thead>
                        <tr>
                            <th>Appliance</th>
                            <th>Wattage</th>
                            <th>Hours Used</th>
                            <th>Cost (Php)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="total-result"></div>
        </div>
        <script>
            const form = document.getElementById('energy-form');
            const resultDiv = document.getElementById('result');
            const applianceSelect = document.getElementById('appliance');
            const wattageInput = document.getElementById('wattage');
            const applianceTable = document.getElementById('appliance-table');
            const applianceTableBody = applianceTable.getElementsByTagName('tbody')[0] || applianceTable.appendChild(document.createElement('tbody'));
            const suggestTable = document.getElementById('suggest-table');
            const suggestTableBody = suggestTable.getElementsByTagName('tbody')[0] || applianceTable.appendChild(document.createElement('tbody'));
            const calculateButton = document.getElementById('calculate-button');
            const suggestionDiv = document.getElementById('suggestion');
            const targetBudget = document.getElementById('target-budget').value;
            console.log(targetBudget);  

            window.onscroll = function() {myFunction()};

            var navbar = document.getElementById("navbar");
            var sticky = navbar.offsetTop;

            function myFunction() {
                if (window.pageYOffset >= sticky) {
                    navbar.classList.add("sticky")
                } else {
                    navbar.classList.remove("sticky");
                }
            }

            function openNav() {
                document.getElementById("sidebar").style.width = "250px";
                document.getElementById("main").style.marginRight = "250px";
            }

            function closeNav() {
                document.getElementById("sidebar").style.width = "0";
                document.getElementById("main").style.marginRight= "0";
            }

            applianceSelect.addEventListener('change', (e) => {
                const selectedAppliance = applianceSelect.value;
                const wattage = applianceSelect.options[applianceSelect.selectedIndex].getAttribute('data-wattage');
                wattageInput.value = wattage;
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();

                // const targetBudget = document.getElementById('target-budget').value;
                const appliance = applianceSelect.value;
                const wattage = wattageInput.value;
                const hoursUsed = document.getElementById('hours-used').value;

                // Calculate energy cost based on the inputs
                const energyCost = calculateEnergyCost(wattage, hoursUsed);

                // Display the result
                // resultDiv.innerHTML = `Your ${appliance} uses ${energyCost.toFixed(2)} units of energy per day. Your target budget is ${targetBudget}.`;

                // // Add some basic validation
                // if (energyCost > targetBudget) {
                //     resultDiv.style.color = 'red';
                //     resultDiv.innerHTML += ` You are exceeding your target budget!`;
                // } else {
                //     resultDiv.style.color = 'green';
                // }

                // Add the appliance to the table
                const newRow = applianceTableBody.insertRow();
                const applianceCell = newRow.insertCell();
                const wattageCell = newRow.insertCell();
                const hoursUsedCell = newRow.insertCell();
                const costCell = newRow.insertCell();
                const actionsCell = newRow.insertCell();

                applianceCell.innerHTML = appliance;
                wattageCell.innerHTML = wattage;
                hoursUsedCell.innerHTML = hoursUsed;
                costCell.innerHTML = energyCost.toFixed(2);

                const editButtons = createEditButtons(newRow);
                actionsCell.appendChild(editButtons);

                // const suggestRow = suggestTableBody.insertRow();
                // const suggestApplianceCell = suggestRow.insertCell();
                // const suggestWattageCell = suggestRow.insertCell();
                // const suggestHoursUsedCell = suggestRow.insertCell();
                // const suggestCostCell = suggestRow.insertCell();

                // suggestApplianceCell.innerHTML = appliance;
                // suggestWattageCell.innerHTML = wattage;
                // suggestHoursUsedCell.innerHTML = hoursUsed;
                //suggestCostCell.innerHTML = 

                // Reset the form
                // form.reset();
                document.getElementById("hours-used").value = "";


                // Focus on the target budget input
                document.getElementById('target-budget').focus();
            });

            function calculateEnergyCost(wattage, hoursUsed) {
                const energyCostPerHour = ((wattage * hoursUsed/1000)) * 11.9397; 
                return energyCostPerHour;
            }   

            function createEditButtons(row) {
                const editButtons = document.createElement('div');
                editButtons.classList.add('edit-buttons');

                const editButton = document.createElement('button');
                editButton.innerHTML = 'Edit';
                editButton.addEventListener('click', () => {
                    row.setAttribute('data-editing', 'true');

                    const applianceCell = row.cells[0];
                    const applianceInput = document.createElement('input');
                    applianceInput.type = 'text';
                    applianceInput.value = applianceCell.innerHTML;
                    applianceCell.innerHTML = '';
                    applianceCell.appendChild(applianceInput);

                    const wattageCell = row.cells[1];
                    const wattageInput = document.createElement('input');
                    wattageInput.type = 'number';
                    wattageInput.value = wattageCell.innerHTML;
                    wattageCell.innerHTML = '';
                    wattageCell.appendChild(wattageInput);

                    const hoursUsedCell = row.cells[2];
                    const hoursUsedInput = document.createElement('input');
                    hoursUsedInput.type = 'number';
                    hoursUsedInput.value = hoursUsedCell.innerHTML;
                    hoursUsedCell.innerHTML = '';
                    hoursUsedCell.appendChild(hoursUsedInput);

                    const costCell = row.cells[3];
                    costCell.innerHTML = '';

                    const saveButton = document.createElement('button');
                    saveButton.innerHTML = 'Save';
                    saveButton.addEventListener('click', () => {
                        row.removeAttribute('data-editing');

                        applianceCell.innerHTML = applianceInput.value;
                        wattageCell.innerHTML = wattageInput.value;
                        hoursUsedCell.innerHTML = hoursUsedInput.value;
                        
                        // const suggestRow = suggestTableBody.insertRow();
                        // const suggestApplianceCell = suggestRow.insertCell();
                        // const suggestWattageCell = suggestRow.insertCell();
                        // const suggestHoursUsedCell = suggestRow.insertCell();
                        // const suggestCostCell = suggestRow.insertCell();
                        // suggestApplianceCell.innerHTML = applianceInput.value;
                        // suggestWattageCell.innerHTML = wattageInput.value;
                        // suggestHoursUsedCell.innerHTML = hoursUsedInput.value;

                        const newEnergyCost = calculateEnergyCost(wattageInput.value, hoursUsedInput.value);
                        costCell.innerHTML = newEnergyCost.toFixed(2);

                        editButtons.style.display = 'flex';
                        saveButton.style.display = 'none';
                    });

                    const cancelButton = document.createElement('button');
                    cancelButton.innerHTML = 'Cancel';
                    cancelButton.addEventListener('click', () => {
                        row.removeAttribute('data-editing');

                        applianceCell.innerHTML = applianceInput.value;
                        wattageCell.innerHTML = wattageInput.value;
                        hoursUsedCell.innerHTML = hoursUsedInput.value;

                        const newEnergyCost = calculateEnergyCost(wattageInput.value, hoursUsedInput.value);
                        costCell.innerHTML = newEnergyCost.toFixed(2);

                        editButtons.style.display = 'flex';
                        saveButton.style.display = 'none';
                    });

                    editButtons.style.display = 'none';
                    costCell.appendChild(saveButton);
                    costCell.appendChild(cancelButton);
                });

                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = 'Delete';
                deleteButton.classList.add('delete-button');
                deleteButton.addEventListener('click', () => {
                    applianceTableBody.removeChild(row);
                });

                editButtons.appendChild(editButton);
                editButtons.appendChild(deleteButton);

                return editButtons;
            }

            function addToTotal(energyCost) {
            // Get the current total or set it to 0 if it doesn't exist
            let total = parseFloat(totalResultDiv.getAttribute('data-total')) || 0;

            // Add the new energy cost to the total
            total += energyCost;

            // Update the total result div
            totalResultDiv.innerHTML = `Total Energy Cost: ${total.toFixed(2)}`;
            totalResultDiv.setAttribute('data-total', total);
        }

        calculateButton.addEventListener('click', () => {
                let totalCost = 0;
                const rows = applianceTableBody.rows;
                for (let i = 0; i < rows.length; i++) {
                    const costCell = rows[i].cells[3];
                    totalCost += parseFloat(costCell.innerHTML);
                }
                suggestionDiv.innerHTML = `Total Energy Cost: ${totalCost.toFixed(2)}`;
                var targetBudget = parseFloat(document.getElementById("target-budget").value);
                console.log(targetBudget);
                
                if (totalCost > targetBudget) {
                    resultDiv.style.color = 'red';
                    resultDiv.innerHTML += ` You are exceeding your target budget!`;

                    if (document.getElementById('suggest-table').style.visibility = 'hidden') {
                        // element.removeAttribute('hidden');
                        document.getElementById('suggest-table').style.visibility = 'visible';
                        console.log("show");
                    }
                    else {
                        document.getElementById('suggest-table').style.visibility = 'hidden';
                        console.log("hide");
                    } 

                } else {
                    resultDiv.style.color = 'green';
                    resultDiv.innerHTML += ` You are on your target budget!`;
                }

                const suggestRow = suggestTableBody.insertRow();
                const suggestApplianceCell = suggestRow.insertCell();
                const suggestWattageCell = suggestRow.insertCell();
                const suggestHoursUsedCell = suggestRow.insertCell();
                const suggestCostCell = suggestRow.insertCell();

                // suggestApplianceCell.innerHTML = appliance;
                // suggestWattageCell.innerHTML = wattage;
                // suggestHoursUsedCell.innerHTML = hoursUsed;

                // Get the appliance table and its rows
                const applianceTable = document.getElementById('appliance-table');
                const applianceTableRows = applianceTable.getElementsByTagName('tr');

                // Loop through each row in the appliance table
                for (let i = 0; i < applianceTableRows.length; i++) {
                    const row = applianceTableRows[i];
                    console.log("wow");

                    // Get the cells in the row
                    const applianceCell = row.cells[0];
                    const wattageCell = row.cells[1];
                    const hoursUsedCell = row.cells[2];

                    // Get the values of the cells
                    const appliance = applianceCell.innerText;
                    const wattage = wattageCell.innerText;
                    const hoursUsed = hoursUsedCell.innerText;
                    console.log(appliance);
                    console.log(wattage);
                    console.log(hoursUsed);


                    // Create a new row in the suggestion table
                    const suggestRow = suggestTable.insertRow();

                    // Create cells in the new row and insert the values
                    const suggestApplianceCell = suggestRow.insertCell();
                    suggestApplianceCell.innerText = appliance;

                    const suggestWattageCell = suggestRow.insertCell();
                    suggestWattageCell.innerText = wattage;

                    const suggestHoursUsedCell = suggestRow.insertCell();
                    suggestHoursUsedCell.innerText = hoursUsed;
                    console.log("wee");
                }

                form.reset();
            });

        function updateTotal() {
            // Get the total energy cost from the table
            let total = 0;
            const rows = applianceTableBody.rows;
            for (let i = 0; i < rows.length; i++) {
                const costCell = rows[i].cells[3];
                total += parseFloat(costCell.innerHTML);
            }

            // Update the total result div
            totalResultDiv.innerHTML = `Total Energy Cost: ${total.toFixed(2)}`;
            totalResultDiv.setAttribute('data-total', total);
        }

        </script>
    </body>
</html>
